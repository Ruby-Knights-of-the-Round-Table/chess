<div class="dashboard" align="center">
  <h1 class="dashtitle">Dashboard</h1>
  <h3 class="playeremail"><%= current_player.email %></h3>
  <hr>

  <table>
  <thead>
    <tr>
      <th> <h2 class="gamesTitle"> My Games (MY TURN)</h2></th>
      <th colspan="3"></th>
    </tr>
  </thead>

  <% if @all_games.available.last != nil %>
    <div class="games" data-game-id="<%= @all_games.available.last.id %>">
        <% @games.each do |game| %>
          <tr>
            <td><h3><%= game.game_name %></h3></td>
            <td><button class="dashButton"><%= link_to 'Play', game_path(game) %></button></td>
            <td><button class="dashButton"><%= link_to 'Delete', game_path(game), method: :delete %></button></td>
          </tr>
        <% end %>
    </div>
  <% end %>
</table>

<br />
<button class="dashButton"><%= link_to 'New Game', new_game_path %></button>
<br/><br>
<button class="dashButton"><%= link_to 'Back', :back %></button>

    <h1> Open Games (OPPONENT'S TURN)</h1>
      <div class="open-games">
        <% @all_games.available.each do |game| %>
          <% if game.white_player_id != current_player.id %>
            <tr>
              <td><h3><%= game.game_name %></h3></td>
              <td><button class="dashButton"><%= link_to 'Join game', join_game_path(game), method: :patch %></button></td>
            </tr>
          <% end %>
        <% end %>
      </div>

</div>

<script>
$(function() {
  var rootRef = firebase.database().ref();
  var gameID = "game"+ $('.games').data('game-id');
  var createGameRef = rootRef.child(gameID);

  createGameRef.on('value', function(snapshot) {
    var data = snapshot.val();
    if (data) {
      console.log(data.gameName);
      console.log(data.gameID);
      console.log(gameID);
      $('.open-games').append("<h3>" + data.gameName + "</h3>");
    }
  });

});
</script>
